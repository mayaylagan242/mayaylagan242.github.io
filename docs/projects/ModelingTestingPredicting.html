<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Maya Ylagan - SDS348">
<meta name="dcterms.date" content="2021-01-01">

<title>Modeling, Testing, and Predicting – mysite</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-b1f70d07cd87deda94dcb53126680b4c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Maya Ylagan</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects/index.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="../github.com/mayaylagan242" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#package-and-data-import" id="toc-package-and-data-import" class="nav-link" data-scroll-target="#package-and-data-import">Package and Data import</a></li>
  <li><a href="#manova" id="toc-manova" class="nav-link" data-scroll-target="#manova">MANOVA</a>
  <ul class="collapse">
  <li><a href="#run-manova" id="toc-run-manova" class="nav-link" data-scroll-target="#run-manova">Run MANOVA</a></li>
  <li><a href="#univariate-anovas" id="toc-univariate-anovas" class="nav-link" data-scroll-target="#univariate-anovas">Univariate ANOVAs</a></li>
  <li><a href="#post-hoc-t-tests" id="toc-post-hoc-t-tests" class="nav-link" data-scroll-target="#post-hoc-t-tests">Post-hoc t-tests</a></li>
  <li><a href="#manova-assumptions" id="toc-manova-assumptions" class="nav-link" data-scroll-target="#manova-assumptions">MANOVA assumptions</a></li>
  </ul></li>
  <li><a href="#randomization-test" id="toc-randomization-test" class="nav-link" data-scroll-target="#randomization-test">Randomization test</a></li>
  <li><a href="#linear-regression-model" id="toc-linear-regression-model" class="nav-link" data-scroll-target="#linear-regression-model">Linear Regression Model:</a>
  <ul class="collapse">
  <li><a href="#creating-and-interpreting" id="toc-creating-and-interpreting" class="nav-link" data-scroll-target="#creating-and-interpreting">Creating and Interpreting</a></li>
  <li><a href="#plot-of-the-interaction" id="toc-plot-of-the-interaction" class="nav-link" data-scroll-target="#plot-of-the-interaction">Plot of the Interaction</a></li>
  <li><a href="#linear-model-assumptions" id="toc-linear-model-assumptions" class="nav-link" data-scroll-target="#linear-model-assumptions">Linear Model Assumptions</a></li>
  <li><a href="#robust-standard-errors" id="toc-robust-standard-errors" class="nav-link" data-scroll-target="#robust-standard-errors">Robust standard errors</a></li>
  </ul></li>
  <li><a href="#logistic-regression-models" id="toc-logistic-regression-models" class="nav-link" data-scroll-target="#logistic-regression-models">Logistic Regression Models:</a>
  <ul class="collapse">
  <li><a href="#logistic-model-with-2-predictors" id="toc-logistic-model-with-2-predictors" class="nav-link" data-scroll-target="#logistic-model-with-2-predictors">Logistic Model with 2 predictors</a></li>
  <li><a href="#logistic-model-with-all-predictors" id="toc-logistic-model-with-all-predictors" class="nav-link" data-scroll-target="#logistic-model-with-all-predictors">Logistic Model with all predictors</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modeling, Testing, and Predicting</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Maya Ylagan - SDS348 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 1, 2021</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>With the ongoing pandemic I went to HealthData.gov and found their Community Profile Report (CPR) – County-Level. The following is some information on this dataset based on their documentation. It was developed by Data Strategy and Execution Workgroup in the Joint Coordination Cell, under the White House COVID-19 Team. Each observation in the dataset is county-level. It contains daily snapshots in time that focuses on recent COVID-19 outcomes in the last seven days and changes relative to the week prior.</p>
</section>
<section id="package-and-data-import" class="level2">
<h2 class="anchored" data-anchor-id="package-and-data-import">Package and Data import</h2>
<section id="packages" class="level4">
<h4 class="anchored" data-anchor-id="packages">Packages</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvtnorm)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggExtra)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstatix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rstatix'

The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo

Attaching package: 'zoo'

The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(interactions)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-import" class="level4">
<h4 class="anchored" data-anchor-id="data-import">Data Import</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>FullCovid <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/ModelingTestingPredicting/COVID-19_Community_Profile_Report_-_County-Level.csv"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3272 Columns: 37
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (3): county, state, date
dbl (34): fips, fema_region, cases_last_7_days, cases_per_100k_last_7_days, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>CovidData <span class="ot">&lt;-</span> FullCovid <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">highCases =</span> total_cases<span class="sc">&gt;</span><span class="fu">median</span>(total_cases,<span class="at">na.rm=</span>T) ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">region=</span><span class="fu">recode</span>(state, <span class="at">ME=</span><span class="st">"NE"</span>, <span class="at">MA=</span><span class="st">"NE"</span>, <span class="at">RI=</span><span class="st">"NE"</span>, <span class="at">CT=</span><span class="st">"NE"</span>, <span class="at">NH=</span><span class="st">"NE"</span>, <span class="at">VT=</span><span class="st">"NE"</span>, <span class="at">NY=</span><span class="st">"NE"</span>, <span class="at">PA=</span><span class="st">"NE"</span>, <span class="at">NJ=</span><span class="st">"NE"</span>, <span class="at">DE=</span><span class="st">"NE"</span>, <span class="at">MD=</span><span class="st">"NE"</span>, <span class="at">DC=</span><span class="st">"NE"</span>, <span class="at">PR=</span><span class="st">"SE"</span>, <span class="at">WV=</span><span class="st">"SE"</span>, <span class="at">VA=</span><span class="st">"SE"</span>, <span class="at">KY=</span><span class="st">"SE"</span>, <span class="at">TN=</span><span class="st">"SE"</span>, <span class="at">NC=</span><span class="st">"SE"</span>, <span class="at">SC=</span><span class="st">"SE"</span>, <span class="at">GA=</span><span class="st">"SE"</span>, <span class="at">AL=</span><span class="st">"SE"</span>, <span class="at">MS=</span><span class="st">"SE"</span>, <span class="at">AR=</span><span class="st">"SE"</span>, <span class="at">LA=</span><span class="st">"SE"</span>, <span class="at">FL=</span><span class="st">"SE"</span>, <span class="at">OH=</span><span class="st">"MW"</span>, <span class="at">IN=</span><span class="st">"MW"</span>, <span class="at">MI=</span><span class="st">"MW"</span>, <span class="at">IL=</span><span class="st">"MW"</span>, <span class="at">MO=</span><span class="st">"MW"</span>, <span class="at">WI=</span><span class="st">"MW"</span>, <span class="at">MN=</span><span class="st">"MW"</span>, <span class="at">IA=</span><span class="st">"MW"</span>, <span class="at">KS=</span><span class="st">"MW"</span>, <span class="at">NE=</span><span class="st">"MW"</span>, <span class="at">SD=</span><span class="st">"MW"</span>, <span class="at">ND=</span><span class="st">"MW"</span>, <span class="at">TX=</span><span class="st">"SW"</span>, <span class="at">OK=</span><span class="st">"SW"</span>, <span class="at">NM=</span><span class="st">"SW"</span>, <span class="at">AZ=</span><span class="st">"SW"</span>, <span class="at">CO=</span><span class="st">"W"</span>, <span class="at">WY=</span><span class="st">"W"</span>, <span class="at">MT=</span><span class="st">"W"</span>, <span class="at">ID=</span><span class="st">"W"</span>, <span class="at">WA=</span><span class="st">"W"</span>, <span class="at">OR=</span><span class="st">"W"</span>, <span class="at">UT=</span><span class="st">"W"</span>, <span class="at">NV=</span><span class="st">"W"</span>, <span class="at">CA=</span><span class="st">"W"</span>, <span class="at">AK=</span><span class="st">"W"</span>, <span class="at">HI=</span><span class="st">"W"</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, county, region, highCases, <span class="fu">everything</span>(), <span class="sc">-</span>state,<span class="sc">-</span>fema_region)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here I defined high and low cases by above and below the median value, and recoded the states into regions (NE:North East,SE:South East,MW:Midwest,SW:South West,W:West).</p>
<hr>
</section>
</section>
<section id="manova" class="level2">
<h2 class="anchored" data-anchor-id="manova">MANOVA</h2>
<section id="run-manova" class="level3">
<h3 class="anchored" data-anchor-id="run-manova">Run MANOVA</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>man1<span class="ot">&lt;-</span><span class="fu">manova</span>(<span class="fu">cbind</span>(total_cases,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                   total_deaths, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                   cases_last_7_days, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                   deaths_last_7_days, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                   test_positivity_rate_last_7_days,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                   confirmed_covid_hosp_last_7_days)  <span class="sc">~</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>               region, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">data=</span>CovidData)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(man1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df  Pillai approx F num Df den Df    Pr(&gt;F)    
region       4 0.15215   15.882     24   9640 &lt; 2.2e-16 ***
Residuals 2412                                             
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The MANOVA results indicate that total cases, total deaths, cases from the last 7 days, deaths from the last 7 days, test positivity rate from the last 7 days, and confirmed COVID hospitalizations show a mean difference across different regions of the US.</p>
</section>
<section id="univariate-anovas" class="level3">
<h3 class="anchored" data-anchor-id="univariate-anovas">Univariate ANOVAs</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(man1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Response total_cases :
              Df     Sum Sq    Mean Sq F value    Pr(&gt;F)    
region         4 7.0150e+10 1.7538e+10  19.705 5.634e-16 ***
Residuals   2412 2.1467e+12 8.8999e+08                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Response total_deaths :
              Df    Sum Sq  Mean Sq F value    Pr(&gt;F)    
region         4  52634377 13158594  39.151 &lt; 2.2e-16 ***
Residuals   2412 810675863   336101                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Response cases_last_7_days :
              Df    Sum Sq Mean Sq F value    Pr(&gt;F)    
region         4  24209477 6052369  30.236 &lt; 2.2e-16 ***
Residuals   2412 482815519  200172                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Response deaths_last_7_days :
              Df Sum Sq Mean Sq F value    Pr(&gt;F)    
region         4   3715  928.81  26.256 &lt; 2.2e-16 ***
Residuals   2412  85324   35.37                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Response test_positivity_rate_last_7_days :
              Df Sum Sq   Mean Sq F value    Pr(&gt;F)    
region         4 0.0651 0.0162849  8.5578 7.436e-07 ***
Residuals   2412 4.5899 0.0019029                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

 Response confirmed_covid_hosp_last_7_days :
              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
region         4  195759   48940  23.928 &lt; 2.2e-16 ***
Residuals   2412 4933260    2045                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

855 observations deleted due to missingness</code></pre>
</div>
</div>
<p>Post-hoc univariate ANOVAs each show the prior mentioned predictor variables illustrate a mean difference across region.</p>
</section>
<section id="post-hoc-t-tests" class="level3">
<h3 class="anchored" data-anchor-id="post-hoc-t-tests">Post-hoc t-tests</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Total Cases</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>total_cases, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                CovidData<span class="sc">$</span>region, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value<span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE    SE   SW
NE FALSE    NA    NA   NA
SE  TRUE FALSE    NA   NA
SW  TRUE FALSE  TRUE   NA
W  FALSE  TRUE FALSE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Total Deaths</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>total_deaths, CovidData<span class="sc">$</span>region, <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value <span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE   SE   SW
NE FALSE    NA   NA   NA
SE  TRUE FALSE   NA   NA
SW  TRUE FALSE TRUE   NA
W   TRUE FALSE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Cases in the Last 7 Days</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>cases_last_7_days, CovidData<span class="sc">$</span>region, <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value <span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE   SE   SW
NE FALSE    NA   NA   NA
SE  TRUE FALSE   NA   NA
SW  TRUE FALSE TRUE   NA
W   TRUE FALSE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Deaths int the Last 7 Days</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>deaths_last_7_days, CovidData<span class="sc">$</span>region, <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value <span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE   SE   SW
NE FALSE    NA   NA   NA
SE  TRUE FALSE   NA   NA
SW  TRUE FALSE TRUE   NA
W   TRUE FALSE TRUE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Test Positivity Rate in the Last 7 Days</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>test_positivity_rate_last_7_days, CovidData<span class="sc">$</span>region, <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value <span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE    SE   SW
NE  TRUE    NA    NA   NA
SE FALSE FALSE    NA   NA
SW FALSE  TRUE FALSE   NA
W   TRUE  TRUE FALSE TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Confirmed Covid Hospitalization in the last 7 Days</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(CovidData<span class="sc">$</span>confirmed_covid_hosp_last_7_days, CovidData<span class="sc">$</span>region, <span class="at">p.adj=</span><span class="st">"none"</span>)<span class="sc">$</span>p.value <span class="sc">*</span><span class="dv">67</span> <span class="sc">&gt;</span><span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      MW    NE   SE   SW
NE FALSE    NA   NA   NA
SE  TRUE FALSE   NA   NA
SW  TRUE FALSE TRUE   NA
W   TRUE FALSE TRUE TRUE</code></pre>
</div>
</div>
<p>The above matrices illustrate which group means significantly differ by region and by predictor variable (accounting for the change in significance level mentioned below)</p>
<section id="significance-level-α" class="level4">
<h4 class="anchored" data-anchor-id="significance-level-α">Significance level (α):</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span>(<span class="fl">0.95</span>)<span class="sc">^</span><span class="dv">67</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9678277</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.05</span><span class="sc">/</span><span class="dv">67</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0007462687</code></pre>
</div>
</div>
<p>With 6 numeric predictors and 5 catagorical groups, 67 inference tests were done. This creates a 96.8% chance of having a Type-1 Error. Thus a Bonferroni correction will be done to reduce the 0.05 signifcance level to 0.00075 (7.5e-4).*</p>
</section>
</section>
<section id="manova-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="manova-assumptions">MANOVA assumptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">as.factor</span>(region))</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>DVs <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(total_cases,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         total_deaths, </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>         cases_last_7_days, </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>         deaths_last_7_days, </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>         test_positivity_rate_last_7_days, </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>         confirmed_covid_hosp_last_7_days) </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Test multivariate normality for each group (null: normality met)</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">split</span>(DVs,group), mshapiro_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          MW           NE           SE           SW           W           
statistic 0.3448927    0.6079596    0.4318576    0.3509059    0.2546133   
p.value   2.090146e-26 1.314466e-17 1.098895e-28 1.170625e-16 3.080355e-16</code></pre>
</div>
</div>
<p>The MANOVA fails the first assumption of normality, the other many other assumptions to check that are harder to meet such as Homogeneity of within-group covariance, Linear relationships among dependent variables, and the absence of outliers. This MANOVA is just a proof of concept example.</p>
<hr>
</section>
</section>
<section id="randomization-test" class="level2">
<h2 class="anchored" data-anchor-id="randomization-test">Randomization test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>randData <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(test_positivity_rate_last_7_days,cases_last_7_days)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>sampleCor <span class="ot">&lt;-</span> <span class="fu">cor</span>(randData<span class="sc">$</span>test_positivity_rate_last_7_days, </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                 randData<span class="sc">$</span>cases_last_7_days)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>rand_dist<span class="ot">&lt;-</span><span class="fu">vector</span>()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>){</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  new<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">positives=</span><span class="fu">sample</span>(randData<span class="sc">$</span>test_positivity_rate_last_7_days),<span class="at">cases=</span>randData<span class="sc">$</span>cases_last_7_days) </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  rand_dist[i]<span class="ot">&lt;-</span> <span class="fu">cor</span>(new<span class="sc">$</span>positives, new<span class="sc">$</span>cases)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="fu">data.frame</span>(rand_dist), <span class="fu">aes</span>(<span class="at">x=</span>rand_dist) ) <span class="sc">+</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span>sampleCor), <span class="at">color=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/randomization_test-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">mean</span>(rand_dist<span class="sc">&gt;</span>sampleCor <span class="sc">|</span> rand_dist <span class="sc">&lt;</span> <span class="sc">-</span>sampleCor)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>pval</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The Null Hypothesis of this Randomization Test is that there is no correlation between <code>positive test rate in the past 7 days</code> and the <code>number of cases the past 7 days</code>. The null distribution of the correlation coefficient is illustrated in dark grey, and the in-sample correlation coefficient is the red vertical line. The probability of a value as extreme as the in-sample value under this “randomization distribution” is 0, therefore we reject the null hypothesis that there is no correlation between these 2 variables.</p>
<hr>
</section>
<section id="linear-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-model">Linear Regression Model:</h2>
<section id="creating-and-interpreting" class="level3">
<h3 class="anchored" data-anchor-id="creating-and-interpreting">Creating and Interpreting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lmData <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( cases_last_7_days, </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>          test_positivity_rate_last_7_days, </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>          confirmed_covid_hosp_last_7_days ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">posRate =</span> test_positivity_rate_last_7_days<span class="sc">-</span><span class="fu">mean</span>(test_positivity_rate_last_7_days,<span class="at">na.rm=</span>T) ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">confirmHosp =</span> confirmed_covid_hosp_last_7_days<span class="sc">-</span><span class="fu">mean</span>(CovidData<span class="sc">$</span>confirmed_covid_hosp_last_7_days,<span class="at">na.rm=</span>T) )</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">lm</span>(cases_last_7_days<span class="sc">~</span>posRate<span class="sc">*</span>confirmHosp, <span class="at">data=</span>lmData)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = cases_last_7_days ~ posRate * confirmHosp, data = lmData)

Residuals:
     Min       1Q   Median       3Q      Max 
-2039.63   -33.24   -14.33     1.47  2708.79 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         152.9680     3.9324  38.899  &lt; 2e-16 ***
posRate             431.0901    90.5095   4.763 2.02e-06 ***
confirmHosp           8.6846     0.1005  86.457  &lt; 2e-16 ***
posRate:confirmHosp  11.9381     2.1726   5.495 4.32e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 192.2 on 2413 degrees of freedom
  (855 observations deleted due to missingness)
Multiple R-squared:  0.8242,    Adjusted R-squared:  0.824 
F-statistic:  3771 on 3 and 2413 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Given average <code>test positivity rate over the last 7 days</code> and average <code>confirmed COVID hospitalizations over the last 7 days</code> the predicted value of <code>cases the last 7 days</code> is 152.968 cases*</p>
<p>431.0901 is the slope for <code>test positivity rate over the last 7 days</code> on <code>cases the last 7 days</code> while holding <code>confirmed covid hospitalizations over the last 7 days</code> constant</p>
<p>8.5943 is the slope for <code>confirmed covid hospitalizations over the last 7 days</code> on <code>cases the last 7 days</code> while holding <code>test positivity rate over the last 7 days</code> constant</p>
<p>The effect of <code>positivity rate over the last 7 days</code> is 11.9381 cases higher for every percent above the mean <code>positivity rate over the last 7 days</code></p>
<p>This linear model explains 82.42% of variance in <code>cases the last 7 days</code></p>
</section>
<section id="plot-of-the-interaction" class="level3">
<h3 class="anchored" data-anchor-id="plot-of-the-interaction">Plot of the Interaction</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interact_plot</span>(fit, confirmHosp, posRate, <span class="at">plot.points =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/interaction_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="linear-model-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="linear-model-assumptions">Linear Model Assumptions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Normality</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(fit<span class="sc">$</span>residuals) <span class="co">#H0: true distribution is normal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  fit$residuals
W = 0.49026, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Homoscedasticity</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>fit<span class="sc">$</span>fitted.values,<span class="at">y=</span>fit<span class="sc">$</span>residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/linear_model_assumptions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(fit) <span class="co"># H0: homoskedastic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  fit
BP = 979.38, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>This linear model fails normality and homoscedasticity</p>
</section>
<section id="robust-standard-errors" class="level3">
<h3 class="anchored" data-anchor-id="robust-standard-errors">Robust standard errors</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(fit, <span class="at">vcov=</span><span class="fu">vcovHC</span>(fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         152.96796    5.23374 29.2273  &lt; 2e-16 ***
posRate             431.09008  170.74945  2.5247  0.01164 *  
confirmHosp           8.68462    0.69314 12.5295  &lt; 2e-16 ***
posRate:confirmHosp  11.93807   14.54385  0.8208  0.41182    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Because the model failed homoskeydacity so robust SE were used allo2ing for non-constant variance. The robust SE changed the significance of the interaction, increased the <code>positivity rate over the last 7 days</code> p-value, but not above 0.05, and decreased all t values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>samp_distn<span class="ot">&lt;-</span><span class="fu">replicate</span>(<span class="dv">5000</span>, {  </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  boot_dat <span class="ot">&lt;-</span> <span class="fu">sample_frac</span>(lmData, <span class="at">replace=</span>T) <span class="co">#take bootstrap sample of rows  </span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  bootfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(cases_last_7_days<span class="sc">~</span>posRate<span class="sc">*</span>confirmHosp, <span class="at">data=</span>boot_dat) <span class="co">#fit model on bootstrap sample  </span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bootfit) <span class="co">#save coefs</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>}) </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>samp_distn <span class="sc">%&gt;%</span> t <span class="sc">%&gt;%</span> as.data.frame <span class="sc">%&gt;%</span> <span class="fu">summarize_all</span>(sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)  posRate confirmHosp posRate:confirmHosp
1    5.052734 168.3468   0.6375838            14.74948</code></pre>
</div>
</div>
<p>The bootstrapped SEs are very similar to robust SE and much higher than the original SE, illustrating the robust SE are a more accurate measure of the sample than than the original SE.</p>
<hr>
</section>
</section>
<section id="logistic-regression-models" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-models">Logistic Regression Models:</h2>
<section id="logistic-model-with-2-predictors" class="level3">
<h3 class="anchored" data-anchor-id="logistic-model-with-2-predictors">Logistic Model with 2 predictors</h3>
<section id="creating-and-interpreting-1" class="level4">
<h4 class="anchored" data-anchor-id="creating-and-interpreting-1">Creating and Interpreting</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(highCases<span class="sc">~</span>cases_last_7_days<span class="sc">+</span>total_deaths, <span class="at">data=</span>CovidData, <span class="at">family=</span><span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = highCases ~ cases_last_7_days + total_deaths, family = "binomial", 
    data = CovidData)

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)       -3.810729   0.137967  -27.62   &lt;2e-16 ***
cases_last_7_days  0.036071   0.002675   13.48   &lt;2e-16 ***
total_deaths       0.055663   0.002484   22.41   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4534.6  on 3270  degrees of freedom
Residual deviance: 1585.5  on 3268  degrees of freedom
  (1 observation deleted due to missingness)
AIC: 1591.5

Number of Fisher Scoring iterations: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(fit2<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Intercept) cases_last_7_days      total_deaths 
       0.02213204        1.03672930        1.05724118 </code></pre>
</div>
</div>
<p>Given the above model’s coefficients: for every 1 unit increase in <code>cases in the last 7 days</code> the odds of <code>highCases</code> incrase by 1.01, and for every 1 unit increase in <code>total deaths</code> the odds of <code>highCases</code> increase by 1.02</p>
</section>
<section id="confusion-matrix" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>CovidData <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">complete.cases</span>(CovidData<span class="sc">$</span>highCases),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">complete.cases</span>(CovidData<span class="sc">$</span>cases_last_7_days),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">complete.cases</span>(CovidData<span class="sc">$</span>total_deaths) )</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Predicted =</span> (<span class="fu">predict</span>(fit2,<span class="at">type=</span><span class="st">"response"</span>)<span class="sc">&gt;</span><span class="fl">0.5</span>) , </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">Actual =</span> CovidData<span class="sc">$</span>highCases) <span class="sc">%&gt;%</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="ot">-&gt;</span> conf_mat</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="ot">&lt;-</span> conf_mat <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Actual) <span class="sc">%&gt;%</span> </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent=</span>Freq<span class="sc">/</span><span class="fu">sum</span>(Freq))</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(conf_mat) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">y=</span><span class="fu">factor</span>(Predicted,<span class="at">levels=</span><span class="fu">c</span>(F,T)),</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x=</span><span class="fu">factor</span>(Actual,<span class="at">levels=</span><span class="fu">c</span>(T,F)),</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill=</span>Freq,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">label=</span><span class="fu">paste0</span>(<span class="fu">round</span>(percent<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),<span class="st">"%"</span>) ) <span class="sc">+</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  ggfittext<span class="sc">::</span><span class="fu">geom_fit_text</span>(<span class="at">contrast =</span> <span class="cn">TRUE</span>, <span class="at">reflow =</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_discrete</span>() <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Actual"</span>) <span class="sc">+</span> </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Predicted"</span>) <span class="sc">+</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/confusion_matrix-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the confusion matrix it appears the model is doing a decent job at classifying points with as little as 5.99% to 12.23% error.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>class_diag<span class="ot">&lt;-</span><span class="cf">function</span>(probs,truth){</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  tab<span class="ot">&lt;-</span><span class="fu">table</span>(<span class="fu">factor</span>(probs<span class="sc">&gt;</span>.<span class="dv">5</span>,<span class="at">levels=</span><span class="fu">c</span>(<span class="st">"FALSE"</span>,<span class="st">"TRUE"</span>)),truth)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  acc<span class="ot">=</span><span class="fu">sum</span>(<span class="fu">diag</span>(tab))<span class="sc">/</span><span class="fu">sum</span>(tab)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  sens<span class="ot">=</span>tab[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">colSums</span>(tab)[<span class="dv">2</span>]</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  spec<span class="ot">=</span>tab[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span><span class="fu">colSums</span>(tab)[<span class="dv">1</span>]</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  ppv<span class="ot">=</span>tab[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span><span class="fu">rowSums</span>(tab)[<span class="dv">2</span>]</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.numeric</span>(truth)<span class="sc">==</span><span class="cn">FALSE</span> <span class="sc">&amp;</span> </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.logical</span>(truth)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    truth<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(truth)<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#CALCULATE EXACT AUC</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  ord<span class="ot">&lt;-</span><span class="fu">order</span>(probs, <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> probs[ord]; truth <span class="ot">&lt;-</span> truth[ord]</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  TPR<span class="ot">=</span><span class="fu">cumsum</span>(truth)<span class="sc">/</span><span class="fu">max</span>(<span class="dv">1</span>,<span class="fu">sum</span>(truth)) </span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  FPR<span class="ot">=</span><span class="fu">cumsum</span>(<span class="sc">!</span>truth)<span class="sc">/</span><span class="fu">max</span>(<span class="dv">1</span>,<span class="fu">sum</span>(<span class="sc">!</span>truth))</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  dup<span class="ot">&lt;-</span><span class="fu">c</span>(probs[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">&gt;=</span>probs[<span class="sc">-</span><span class="fu">length</span>(probs)], <span class="cn">FALSE</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  TPR<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,TPR[<span class="sc">!</span>dup],<span class="dv">1</span>); FPR<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,FPR[<span class="sc">!</span>dup],<span class="dv">1</span>)</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(TPR)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  auc<span class="ot">&lt;-</span> <span class="fu">sum</span>( ((TPR[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">+</span>TPR[<span class="sc">-</span>n])<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> (FPR[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">-</span>FPR[<span class="sc">-</span>n]) )</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(acc,sens,spec,ppv,auc)</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a><span class="fu">class_diag</span>(probs, CovidData<span class="sc">$</span>highCases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           acc      sens      spec       ppv       auc
TRUE 0.8994191 0.8348624 0.9639364 0.9585674 0.9720858</code></pre>
</div>
</div>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Measure</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Accuracy</td>
<td>89.94 %</td>
</tr>
<tr class="even">
<td>Sensitivity</td>
<td>83.49 %</td>
</tr>
<tr class="odd">
<td>Specificity</td>
<td>96.39 %</td>
</tr>
<tr class="even">
<td>Positive Predictive Value</td>
<td>95.86 %</td>
</tr>
<tr class="odd">
<td>Area Under the ROC Curve</td>
<td>97.21 %</td>
</tr>
</tbody>
</table>
<p>The above table and provides diagnostic measures of the predictive power of the Logistic Model with 2 predictors.</p>
</section>
<section id="density-plot" class="level4">
<h4 class="anchored" data-anchor-id="density-plot">Density Plot</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>densityVal <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">logit=</span><span class="fu">fitted</span>(fit2) )</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(densityVal) <span class="sc">+</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x=</span>logit, <span class="at">fill=</span>highCases) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha=</span>.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/density_plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The above density plot illustrates the predictor value (logit) compared to the actual group membership to <code>highCases</code>.</p>
</section>
<section id="roc-and-auc" class="level4">
<h4 class="anchored" data-anchor-id="roc-and-auc">ROC and AUC</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ROCplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(CovidData)<span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">d=</span>highCases,<span class="at">m=</span>cases_last_7_days<span class="sc">+</span>total_deaths) <span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_roc</span>(<span class="at">n.cuts=</span><span class="dv">0</span>) </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>ROCplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in verify_d(data$d): D not labeled 0/1, assuming FALSE = 0 and TRUE =
1!</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ModelingTestingPredicting_files/figure-html/ROC_AUC-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc_auc</span>(ROCplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in verify_d(data$d): D not labeled 0/1, assuming FALSE = 0 and TRUE =
1!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  PANEL group       AUC
1     1    -1 0.9704336</code></pre>
</div>
</div>
<p>The above ROC curve is of the logistic model with 2 predictors. Based on the shape of the ROC curve and the AUC of the ROC curve, the classification of this 2 predictor logistical model is very good</p>
</section>
</section>
<section id="logistic-model-with-all-predictors" class="level3">
<h3 class="anchored" data-anchor-id="logistic-model-with-all-predictors">Logistic Model with all predictors</h3>
<section id="creating-and-interpreting-2" class="level4">
<h4 class="anchored" data-anchor-id="creating-and-interpreting-2">Creating and Interpreting</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>lassoData <span class="ot">&lt;-</span> CovidData <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>fips, <span class="sc">-</span>county,<span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  na.omit</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>fit3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(highCases<span class="sc">~</span>(.), <span class="at">data=</span>lassoData)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit3,<span class="at">data=</span>CovidData)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class_diag</span>(probs, lassoData<span class="sc">$</span>highCases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           acc sens       spec       ppv       auc
TRUE 0.9338624    1 0.01960784 0.9337748 0.9359477</code></pre>
</div>
</div>
<p>From including all variables the model was made more flexible, but had lower values for Accuracy, Sensitivity, and AUC, as there was more noise introduced.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Measure</th>
<th>2 Predictor Value</th>
<th>All Predictor Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Accuracy</td>
<td>89.94 %</td>
<td>93.38 %</td>
</tr>
<tr class="even">
<td>Sensitivity</td>
<td>83.49 %</td>
<td>100 %</td>
</tr>
<tr class="odd">
<td>Specificity</td>
<td>96.39 %</td>
<td>0.02 %</td>
</tr>
<tr class="even">
<td>Positive Predictive Value</td>
<td>95.86 %</td>
<td>93.38 %</td>
</tr>
<tr class="odd">
<td>Area Under the ROC Curve</td>
<td>97.21 %</td>
<td>93.59 %</td>
</tr>
</tbody>
</table>
</section>
<section id="fold-cross-validation" class="level4">
<h4 class="anchored" data-anchor-id="fold-cross-validation">10 Fold Cross Validation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>cvData<span class="ot">&lt;-</span>lassoData[<span class="fu">sample</span>(<span class="fu">nrow</span>(lassoData)),] <span class="co">#randomly order rows</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>folds<span class="ot">&lt;-</span><span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lassoData)),<span class="at">breaks=</span>k,<span class="at">labels=</span>F) <span class="co">#create folds</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>diags<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create training and test sets  </span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  train<span class="ot">&lt;-</span>cvData[folds<span class="sc">!=</span>i,]   </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  test<span class="ot">&lt;-</span>cvData[folds<span class="sc">==</span>i,]  </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  truth<span class="ot">&lt;-</span>test<span class="sc">$</span>highCases <span class="do">## Truth labels for fold i</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Train model on training set (all but fold i)  </span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  lassofit<span class="ot">&lt;-</span><span class="fu">glm</span>(highCases<span class="sc">~</span>(.),<span class="at">data=</span>train,<span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Test model on test set (fold i)   </span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  probs<span class="ot">&lt;-</span><span class="fu">predict</span>(lassofit,<span class="at">newdata =</span> test,<span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Get diagnostics for fold i  </span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  diags<span class="ot">&lt;-</span><span class="fu">rbind</span>(diags,<span class="fu">class_diag</span>(probs,truth))</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_all</span>(diags,mean) <span class="co">#average diagnostics across all k folds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        acc      sens      spec       ppv       auc
1 0.9682807 0.9787905 0.7966667 0.9871751 0.9293887</code></pre>
</div>
</div>
<p>There is surprisingly no sign of overfitting the more flexible model by using all predictors. When having many degrees of freedom you can over fit the cross-validation criteria for the model to be tuned to exploit the random variation in the dataset rather than improve predictive performance, which is what likely is occurring here. To counteract this LASSO will be used to reduce the degrees of freedom.</p>
</section>
<section id="lasso" class="level4">
<h4 class="anchored" data-anchor-id="lasso">LASSO</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fu">as.matrix</span>(lassoData<span class="sc">$</span>highCases) <span class="co">#grab response</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">&lt;-</span><span class="fu">model.matrix</span>(highCases<span class="sc">~</span>(.),<span class="at">data=</span>lassoData)[,<span class="sc">-</span><span class="dv">1</span>] <span class="co">#grab predictors</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>cv<span class="ot">&lt;-</span><span class="fu">cv.glmnet</span>(x,y,<span class="at">family=</span><span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: from glmnet C++ code (error code -97); Convergence for 97th lambda
value not reached after maxit=100000 iterations; solutions for larger lambdas
returned</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>lasso<span class="ot">&lt;-</span><span class="fu">glmnet</span>(x,y,<span class="at">family=</span><span class="st">"binomial"</span>,<span class="at">lambda=</span>cv<span class="sc">$</span>lambda<span class="fl">.1</span>se)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>var_to_select <span class="ot">&lt;-</span> <span class="fu">dimnames</span>(<span class="fu">coef</span>(lasso))[[<span class="dv">1</span>]][<span class="fu">coef</span>(lasso)<span class="sc">@</span>i <span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>newLassoData <span class="ot">&lt;-</span> lassoData <span class="sc">%&gt;%</span> </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regionNE=</span>(region<span class="sc">==</span><span class="st">"NE"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regionSW=</span>(region<span class="sc">==</span><span class="st">"SW"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regionW =</span>(region<span class="sc">==</span><span class="st">"W"</span> ))</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>lassoSelectedVarFunction <span class="ot">&lt;-</span> highCases<span class="sc">~</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  regionNE<span class="sc">+</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  regionSW<span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  regionW<span class="sc">+</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  cases_per_100k_last_7_days<span class="sc">+</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  total_cases<span class="sc">+</span></span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>  cases_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>  deaths_per_100k_last_7_days<span class="sc">+</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  total_deaths<span class="sc">+</span></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>  deaths_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>  test_positivity_rate_last_7_days<span class="sc">+</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>  total_tests_last_7_days<span class="sc">+</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  total_tests_per_100k_last_7_days<span class="sc">+</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  test_positivity_rate_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>  total_tests_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>  confirmed_covid_hosp_last_7_days<span class="sc">+</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>  confirmed_covid_hosp_per_100_beds_last_7_days<span class="sc">+</span></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>  confirmed_covid_hosp_per_100_beds_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>  suspected_covid_hosp_last_7_days<span class="sc">+</span></span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>  suspected_covid_hosp_per_100_beds_last_7_days<span class="sc">+</span></span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>  suspected_covid_hosp_per_100_beds_pct_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>  pct_inpatient_beds_used_avg_last_7_days<span class="sc">+</span></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>  pct_inpatient_beds_used_abs_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>  pct_icu_beds_used_avg_last_7_days<span class="sc">+</span></span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>  pct_icu_beds_used_abs_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>  pct_icu_beds_used_covid_avg_last_7_days<span class="sc">+</span></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a>  pct_icu_beds_used_covid_abs_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a>  pct_vents_used_avg_last_7_days<span class="sc">+</span></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>  pct_vents_used_abs_change_from_prev_week<span class="sc">+</span></span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>  pct_vents_used_covid_avg_last_7_days<span class="sc">+</span></span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>  pct_vents_used_covid_abs_change_from_prev_week</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The variables that were selected by LASSO were those that increased the ability of the model to predict highCases and did not add extra noise in the data for the model to learn. We can see that most of the variables were selected, so the cross-validation critera was not over fit.</p>
</section>
<section id="cv-with-lasso-variables" class="level4">
<h4 class="anchored" data-anchor-id="cv-with-lasso-variables">CV with LASSO Variables</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">######## IN-SAMPLE ########</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>fitLasso <span class="ot">&lt;-</span> <span class="fu">glm</span>(lassoSelectedVarFunction, <span class="at">data=</span>newLassoData)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(fitLasso)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class_diag</span>(probs, newLassoData<span class="sc">$</span>highCases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           acc sens       spec       ppv       auc
TRUE 0.9338624    1 0.01960784 0.9337748 0.9290224</code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="do">######## OUT-OF-SAMPLE ########</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>k<span class="ot">=</span><span class="dv">10</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>cvData<span class="ot">&lt;-</span>newLassoData[<span class="fu">sample</span>(<span class="fu">nrow</span>(newLassoData)),] <span class="co">#randomly order rows</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>folds<span class="ot">&lt;-</span><span class="fu">cut</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(newLassoData)),<span class="at">breaks=</span>k,<span class="at">labels=</span>F) <span class="co">#create folds</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>diags<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Create training and test sets  </span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  train<span class="ot">&lt;-</span>cvData[folds<span class="sc">!=</span>i,]   </span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  test<span class="ot">&lt;-</span>cvData[folds<span class="sc">==</span>i,]  </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  truth<span class="ot">&lt;-</span>test<span class="sc">$</span>highCases <span class="do">## Truth labels for fold i</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>  lassofit<span class="ot">&lt;-</span><span class="fu">glm</span>(lassoSelectedVarFunction,<span class="at">data=</span>train,<span class="at">family=</span><span class="st">"binomial"</span>)  <span class="do">## Train model on training set (all but fold i)  </span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>  probs<span class="ot">&lt;-</span><span class="fu">predict</span>(lassofit,<span class="at">newdata =</span> test,<span class="at">type=</span><span class="st">"response"</span>) <span class="do">## Test model on test set (fold i)   </span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  diags<span class="ot">&lt;-</span><span class="fu">rbind</span>(diags,<span class="fu">class_diag</span>(probs,truth))  <span class="do">## Get diagnostics for fold i</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_all</span>(diags,mean) <span class="co">#average diagnostics across all k folds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        acc      sens      spec       ppv       auc
1 0.9788772 0.9901196 0.8111905 0.9874937 0.9421203</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 20%">
<col style="width: 24%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Measure</th>
<th>2 Predictor Value</th>
<th>All Predictor Value</th>
<th>Post-LASSO Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Accuracy</td>
<td>89.94 %</td>
<td>93.38 %</td>
<td>93.39 %</td>
</tr>
<tr class="even">
<td>Sensitivity</td>
<td>83.49 %</td>
<td>100 %</td>
<td>100 %</td>
</tr>
<tr class="odd">
<td>Specificity</td>
<td>96.39 %</td>
<td>0.02 %</td>
<td>1.96 %</td>
</tr>
<tr class="even">
<td>Positive Predictive Value</td>
<td>95.86 %</td>
<td>93.38 %</td>
<td>93.38 %</td>
</tr>
<tr class="odd">
<td>Area Under the ROC Curve</td>
<td>97.21 %</td>
<td>93.59 %</td>
<td>92.90 %</td>
</tr>
</tbody>
</table>
<p>Using the variables that LASSO selected, the model’s out-of-sample AUC is higher than the model’s in-sample AUC</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>